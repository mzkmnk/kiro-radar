# 設計書: TUI ダッシュボード

## 概要

ratatui フレームワークを使用して、Spec 進捗情報を表示するターミナルダッシュボードを実装します。シンプルで読みやすい UI を目指します。

## アーキテクチャ

### モジュール構成

```
src/
├── ui.rs           # UI描画ロジック
└── app.rs          # アプリケーション状態管理
```

### データフロー

```
アプリケーション状態 → レイアウト構築 → ウィジェット描画 → ターミナル表示
```

## コンポーネントとインターフェース

### DashboardState 構造体

ダッシュボードの表示状態を保持：

```rust
pub struct DashboardState {
    pub spec_name: String,
    pub total_tasks: usize,
    pub completed_tasks: usize,
}
```

### UI 描画関数

```rust
pub fn render_dashboard(frame: &mut Frame, state: &DashboardState);
```

### レイアウト構成

- **ヘッダー**: タイトルと Spec 名
- **メインエリア**: 進捗情報とプログレスバー
- **フッター**: 操作ガイド（'q' to quit）

## データモデル

### DashboardState

- `spec_name`: 表示する Spec 名
- `total_tasks`: 総タスク数
- `completed_tasks`: 完了タスク数

### 計算プロパティ

- 進捗率: `completed_tasks / total_tasks * 100`

## 正確性プロパティ

_プロパティは、システムのすべての有効な実行において真であるべき特性や動作です。これは人間が読める仕様と機械検証可能な正確性保証の橋渡しとなります。_

### プロパティ 1: レイアウト構造の一貫性

*任意の*描画時において、レイアウトは常にヘッダー、メインエリア、フッターの 3 つのセクションを持つ

**検証: 要件 1.2**

### プロパティ 2: レイアウトの適応性

*任意の*ターミナルサイズに対して、レイアウトは利用可能なスペースに適切に調整される

**検証: 要件 1.3**

### プロパティ 3: Spec 名の表示

*任意の*Spec 名に対して、描画された UI にはその Spec 名が含まれる

**検証: 要件 2.1**

### プロパティ 4: タスク情報の表示

*任意の*タスク情報（完了数、総数）に対して、描画された UI にはその数値が含まれる

**検証: 要件 2.2**

### プロパティ 5: プログレスバーの視覚化

*任意の*進捗率（0〜100%）に対して、プログレスバーは適切な割合で描画される

**検証: 要件 2.3**

## エラーハンドリング

### ターミナル初期化エラー

- ターミナルが利用できない: エラーメッセージを表示して終了
- 描画エラー: エラーをログに記録して復旧を試みる

### 入力処理エラー

- 不正なキー入力: 無視して処理を継続
- イベント読み取りエラー: エラーをログに記録

## テスト戦略

### ユニットテスト

- 起動時の UI 表示
- 'q' キー押下時の終了
- 'Esc' キー押下時の終了
- ターミナル復元の確認

### プロパティベーステスト

- **quickcheck** クレートを使用
- 各テストは最低 100 回の反復を実行
- 各プロパティベーステストには、設計書のプロパティ番号を明示的にコメントで記載
- フォーマット: `// Feature: sample-ui-dashboard, Property X: [プロパティテキスト]`

プロパティテストの対象：

- プロパティ 1: レイアウト構造の一貫性
- プロパティ 2: レイアウトの適応性
- プロパティ 3: Spec 名の表示
- プロパティ 4: タスク情報の表示
- プロパティ 5: プログレスバーの視覚化

### テストデータ生成

- ランダムな Spec 名生成
- ランダムなタスク数生成
- ランダムなターミナルサイズ生成

## UI 設計

### カラースキーム

- ヘッダー: シアン背景
- プログレスバー: グリーン（完了部分）、グレー（未完了部分）
- フッター: グレー背景

### レイアウト比率

- ヘッダー: 3 行
- メインエリア: 残りのスペース
- フッター: 1 行
